<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>【Luaコード生成】にゃんこ大戦争 ステータスエディタ v4.0 | 簡単チートコード作成</title>
    
    <!-- ファイル名は変更していません -->
    <link rel="icon" type="image/png" href="profile-icon.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="profile-icon.jpg">
    <link rel="icon" href="profile-icon.jpg">

    <meta name="description" content="検索パターンと数値を入力するだけで、にゃんこ大戦争のステータスを変更するLuaスクリプトを簡単・自動生成。GameGuardian用のチートコードを作成できます。">
   
    
    <!-- URLを実際のドメインに修正 -->
    <link rel="canonical" href="https://nyankohack.tokyo/にゃんこ大戦争.html">

    <!-- OGP / Twitter Card (URLを実際のドメインに修正) -->
    <meta http-equiv="Content-Security-Policy" content="connect-src 'self' https://script.google.com https://script.googleusercontent.com;">
    <meta property="og:title" content="【Luaコード生成】にゃんこ大戦争 ステータスエディタ v4.0">
    <meta property="og:description" content="検索パターン入力だけで、にゃんこ大戦争のLuaスクリプトを簡単・自動生成。">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nyankohack.tokyo/にゃんこ大戦争.html">
    <meta name="twitter:card" content="summary">
    
    <style>
        :root {
            --primary-color: #98FB98; --secondary-color: #3CB371; --bg-color: #F0FFF0;
            --widget-bg: #fff; --text-color: #333; --error-color: #d32f2f;
            --red-check: #ff6b6b; --radius: 12px; --shadow: 0 4px 8px rgba(0,0,0,0.1);
            --border-color: #ccc;
        }
        @media (prefers-color-scheme: dark) {
            :root {
                --primary-color: #2E8B57; --secondary-color: #98FB98; --bg-color: #121212;
                --widget-bg: #1E1E1E; --text-color: #E0E0E0; --shadow: 0 4px 8px rgba(0,0,0,0.4);
                --red-check: #ff8a80; --border-color: #444;
            }
            .nav-btn, .tab-btn { background-color: #333; color: white; }
            .nav-btn:hover { background-color: #555; }
            .tab-btn { border-color: #444; }
            .tab-btn.active { background-color: var(--widget-bg); border-color: #444; border-bottom-color: var(--widget-bg); }
            input[type="text"], input[type="number"], input[type="search"] { background-color: #333; color: var(--text-color); border-color: #555; }
            .content-wrapper { border-color: #444; }
            .status-item:hover { background-color: #2a2a2a; }
            #result-code-wrap pre { background-color: #181818; color: #d4d4d4; }
            .manual-accordion details { border-color: #444; }
            .manual-accordion summary { background-color: #2a2a2a; }
            .manual-accordion div { border-top-color: #444; }
        }
        
        html { scroll-behavior: smooth; }
        body { font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; background-color: var(--bg-color); color: var(--text-color); margin: 0; padding: 20px; }
        .page-wrapper { display: flex; gap: 20px; max-width: 1600px; margin: 0 auto; }
        #manual-section { flex: 1; min-width: 300px; }
        #main-content { flex: 3; min-width: 600px; overflow: hidden; }
        .widget { background-color: var(--widget-bg); padding: 20px; margin-bottom: 20px; border-radius: var(--radius); box-shadow: var(--shadow); border-left: 5px solid var(--secondary-color); }
        h1, h2, h3 { color: var(--secondary-color); border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-top: 0; }
        .input-area { margin-bottom: 15px; }
        .input-area label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="text"], input[type="number"], input[type="search"] { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 16px; box-sizing: border-box; transition: border-color 0.3s; }
        input.is-invalid { border-color: var(--error-color); box-shadow: 0 0 5px rgba(211, 47, 47, 0.5); }
        .top-wrapper { display: flex; flex-wrap: wrap; align-items: center; gap: 15px; }
        .top-wrapper .input-area { flex-grow: 1; margin-bottom: 0; min-width: 250px; }
        .rev-calc-area { display: flex; align-items: center; gap: 5px; padding-top: 20px; }
        .menu-tabs { display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; }
        .tab-btn { padding: 10px 15px; border: 1px solid var(--border-color); background-color: #f0f0f0; color: #333; border-radius: 8px 8px 0 0; cursor: pointer; transition: background-color 0.3s, border-color 0.3s; font-size: 14px; border-bottom: none; }
        .tab-btn.active { background-color: var(--widget-bg); border-bottom: 1px solid var(--widget-bg); position: relative; top: 1px; }
        .content-wrapper { border: 1px solid var(--border-color); padding: 20px; border-radius: 0 var(--radius) var(--radius) var(--radius); }
        .category-content, #search-results-wrapper { display: none; }
        .category-content.active, #search-results-wrapper.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 15px; }
        .status-item { display: flex; align-items: center; padding: 8px; border-radius: 8px; transition: background-color 0.3s; }
        .status-item:hover { background-color: #f9f9f9; }
        .status-item .checks { display: flex; gap: 6px; }
        .status-item input[type="checkbox"] { appearance: none; width: 20px; height: 20px; border-radius: 5px; cursor: pointer; position: relative; transition: transform 0.2s ease; background-color: #ccc; }
        .status-item input[type="checkbox"]:checked { transform: scale(1.1); }
        .status-item input[type="checkbox"]:checked::after { content: '✔'; font-size: 16px; color: white; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); }
        .status-item input[type="checkbox"].green:checked { background-color: var(--secondary-color); }
        .status-item input[type="checkbox"].red:checked { background-color: var(--red-check); }
        .status-item label { flex-grow: 1; font-size: 14px; cursor: pointer; margin: 0 10px; word-break: break-all; }
        .status-item .offset { color: #999; font-size: 12px; }
        .status-item input[type="number"] { flex-shrink: 0; width: 80px; padding: 5px; border: 1px solid var(--border-color); border-radius: 5px; text-align: right; }
        .batch-controls { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; padding: 10px; background-color: #f9f9f9; border-radius: 8px; margin-bottom: 15px; }
        .batch-controls label { font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 5px; }
        .batch-controls input[type="number"] { width: 120px; }
        .action-btn, #reverse-btn, #download-lua-btn { display: block; width: 100%; padding: 15px; font-size: 18px; font-weight: bold; color: white; border: none; border-radius: var(--radius); cursor: pointer; transition: background-color 0.3s; margin-top: 20px; text-align: center; }
        .action-btn { background-color: var(--secondary-color); }
        .action-btn:hover { background-color: #2e8b57; }
        #reverse-btn { background-color: #3498db; display: none; }
        #reverse-btn:hover { background-color: #2980b9; }
        #download-lua-btn { background-color: #e67e22; margin-top: 10px; }
        #download-lua-btn:hover { background-color: #d35400; }
        #result-area, #rev-result-area, #download-lua-section { margin-top: 20px; display: none; }
        #result-code-wrap { position: relative; }
        #result-code-wrap pre { background-color: #2d2d2d; color: #f0f0f0; padding: 15px; padding-top: 40px; border-radius: 8px; white-space: pre-wrap; word-wrap: break-word; }
        #copy-btn { position: absolute; top: 10px; right: 10px; padding: 8px 12px; background-color: var(--secondary-color); color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        #copy-btn:hover { background-color: #2e8b57; }
        .top-nav { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 30px; }
        .nav-btn { display: inline-flex; flex: 1; min-width: 120px; align-items: center; justify-content: center; height: 40px; background-color: var(--secondary-color); color: white; font-weight: bold; text-decoration: none; border-radius: 8px; padding: 0 15px; transition: background-color 0.3s; }
        .nav-btn:hover { background-color: #256d45; }
        .manual-accordion details { margin-bottom: 10px; border: 1px solid var(--border-color); border-radius: 8px; }
        .manual-accordion summary { padding: 15px; font-weight: bold; cursor: pointer; background-color: #f9f9f9; border-radius: 8px 8px 0 0; }
        .manual-accordion div { padding: 15px; border-top: 1px solid var(--border-color); }
        .manual-accordion p { margin-top: 0; line-height: 1.6; }
        .manual-accordion code { background-color: #e8e8e8; padding: 2px 5px; border-radius: 4px; font-family: monospace; }
        
        /* --- レスポンシブ対応 --- */
        @media (max-width: 960px) {
            .page-wrapper { flex-direction: column; }
            #main-content, #manual-section { min-width: unset; }
        }
        
        @media (max-width: 480px) {
            body { padding: 10px; }
            .widget { padding: 15px; }
            h1 { font-size: 1.8em; }
            h2 { font-size: 1.4em; }
            .status-grid { grid-template-columns: 1fr; }
            .status-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                border-bottom: 1px solid var(--border-color);
                padding-bottom: 12px;
                margin-bottom: 5px;
            }
            .status-item label { margin: 0; }
            .status-item input[type="number"] { width: 100%; padding: 8px; }
        }
    </style>
</head>
<body>

<script>
    const GAS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbweFN798v3amYgXHH8ej9TM8RwdadPAvvIImYTwMADpbvzj7jFT6nG9-mcRavBABqSZ/exec';
    const LOGIN_PAGE = 'ログイン.html';
    function getCookie(name) { const nameEQ = name + "="; const ca = document.cookie.split(';'); for (let i = 0; i < ca.length; i++) { let c = ca[i]; while (c.charAt(0) === ' ') c = c.substring(1, c.length); if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length); } return null; }
    function deleteCookie(name) { document.cookie = name + '=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;'; }
    async function verifyAndRecordAccess() { const token = getCookie('session_token'); if (!token) { alert('ログインが必要です。'); window.location.href = LOGIN_PAGE; return; } try { const response = await fetch(GAS_WEB_APP_URL, { method: 'POST', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify({ action: 'recordAccess', token: token }) }); const result = await response.json(); if (result.status !== 'success') { deleteCookie('session_token'); alert(result.message || 'セッションが無効です。再度ログインしてください。'); window.location.href = LOGIN_PAGE; } else { console.log(`認証成功: ようこそ、${result.username}さん`); } } catch (error) { console.error('認証エラー:', error); alert('認証中にエラーが発生しました。ログインページに戻ります。'); window.location.href = LOGIN_PAGE; } }
    verifyAndRecordAccess();
</script>

<div class="page-wrapper">
    <aside id="manual-section">
        <section class="widget">
            <h2>使い方ガイド</h2>
            <div class="manual-accordion">
                <details open>
                    <summary>1. 基本的な流れ</summary>
                    <div>
                        <p>0.<b>コスト値の検索方法について</b>は以下の動画を閲覧してください。</p>
                        <p style="text-align: center;"><iframe width="100%" style="aspect-ratio: 16/9;" src="https://www.youtube.com/embed/rjJ0LMUkkMQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></p>
                        <p>1. <b>検索パターン</b>に、ゲーム内で見つけた連続する数値列を入力します。</p>
                        <p>2. <b>リファイン値</b>が自動で設定されますが、必要であれば手動で修正します。</p>
                        <p>3. <b>検索範囲</b>を選択します。</p>
                        <p>4. 下のメニューから変更したい項目を探し、数値を入力します。</p>
                        <p>5. <b>コード生成</b>ボタンを押し、表示されたコードをコピーして使用します。</p>
                        <p style="text-align: center;"><iframe width="100%" style="aspect-ratio: 16/9;" src="https://www.youtube.com/embed/QRl1QLRN32U" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></p>
                    </div>
                </details>
                <details><summary>2. 検索パターンの入力規則</summary><div>...</div></details>
                <details><summary>3. 逆算モード詳解</summary><div>...</div></details>
                <details><summary>4. 一括操作機能</summary><div>...</div></details>
            </div>
        </section>
    </aside>

    <main id="main-content">
        <section class="widget">
            <h1>にゃんこ大戦争 ステータスエディタ v4.0</h1>
            <div class="top-nav">
                <a href="index.html" class="nav-btn">ホーム</a>
                <a href="開発者について.html" class="nav-btn">開発者について</a>
                <a href="Lua_editor.html" class="nav-btn">Lua editor</a>
            </div>
            <h2>1. 検索＆リファイン設定</h2>
            <div class="top-wrapper">
                <div class="input-area">
                    <label for="dword-in">検索パターン</label>
                    <input type="text" id="dword-in" value="440;3;56;34;30;560;5000;150">
                </div>
                <div class="rev-calc-area">
                    <input type="checkbox" id="rev-calc-check">
                    <label for="rev-calc-check">逆算モード</label>
                </div>
            </div>
            <div class="input-area">
                <label>検索範囲</label>
                <div>
                    <label><input type="checkbox" id="range-cb" value="Cb"> Cb</label>
                    <label><input type="checkbox" id="range-other" value="Other" checked> Other</label>
                </div>
            </div>
            <div class="input-area">
                <label for="refine-in">リファイン値 (コストなど)</label>
                <input type="number" id="refine-in" value="5000">
            </div>
            <div class="input-area lua-prefix-area">
                <!-- ... (Luaコード先頭条件分岐は変更なし) ... -->
            </div>
        </section>
        
        <section id="rev-result-area" class="widget" style="display: none;">
            <h2>逆算結果</h2>
            <ul id="rev-result-list"></ul>
        </section>

        <section class="widget">
            <h2>2. 項目検索＆変更</h2>
            <div>
                 <input type="search" id="search-box" placeholder="項目名で検索...">
            </div>
            <div id="search-results-wrapper"></div>
            <nav class="menu-tabs">
                <button class="tab-btn active" data-target="cat-basic">基本部</button>
                <button class="tab-btn" data-target="cat-basic2">基本部2</button>
                <button class="tab-btn" data-target="cat-perf">性能部</button>
                <button class="tab-btn" data-target="cat-prob">確率性能部</button>
                <button class="tab-btn" data-target="cat-invalid">無効系</button>
                <button class="tab-btn" data-target="cat-other">その他</button>
            </nav>
            <div class="content-wrapper">
                <div id="cat-basic" class="category-content active"></div>
                <div id="cat-basic2" class="category-content"></div>
                <div id="cat-perf" class="category-content"></div>
                <div id="cat-prob" class="category-content"></div>
                <div id="cat-invalid" class="category-content"></div>
                <div id="cat-other" class="category-content"></div>
            </div>
        </section>

        <button id="gen-btn" class="action-btn">コード生成</button>
        <button id="reverse-btn" class="action-btn">逆算実行</button>

        <section id="result-area" class="widget" style="display: none;">
            <h2>3. 生成されたコード</h2>
            <div id="result-code-wrap">
                <pre><code id="result-code"></code></pre>
                <button id="copy-btn">コピー</button>
            </div>
        </section>

        <section id="download-lua-section" class="widget" style="display: none;">
            <h2>4. Luaファイルをダウンロード</h2>
            <p>生成されたコードをLuaファイルとしてダウンロードできます。</p>
            <button id="download-lua-btn" class="action-btn">ファイルをダウンロード</button>
        </section>
    </main>
</div>
             
<script>
    const statusData = [
    { offset: -24, name: '体力' }, { offset: -20, name: 'KB数' }, { offset: -16, name: '速度[2x]' }, { offset: -12, name: '攻撃力' },
    { offset: -8, name: '攻撃間隔' }, { offset: -4, name: '感知射程[4x]' }, { offset: 0, name: 'コスト[100x]' }, { offset: 4, name: '再生産時間' },
    { offset: 8, name: 'キャラの感知範囲(前方)[4x]*' }, { offset: 12, name: 'キャラの感知範囲(後方)[4x]*' }, { offset: 16, name: '対赤' },
    { offset: 24, name: '攻撃種類(0=単/1=範)' }, { offset: 28, name: '攻撃発生(時間)' }, { offset: 32, name: 'キャラ出現y軸範囲(上)*' },
    { offset: 36, name: 'キャラ出現y軸範囲(下)*' }, { offset: 40, name: '対浮' }, { offset: 44, name: '対黒' }, { offset: 48, name: '対メ' },
    { offset: 52, name: '対白' }, { offset: 56, name: '対天' }, { offset: 60, name: '対エ' }, { offset: 64, name: '対ゾ' },
    { offset: 68, name: 'めっぽう強い' }, { offset: 72, name: 'ふっとばす(確率)' }, { offset: 76, name: '動きを止める(確率)' },
    { offset: 80, name: '動きを止める(時間)' }, { offset: 84, name: '動きを遅くする(確率)' }, { offset: 88, name: '動きを遅くする(時間)' },
    { offset: 92, name: '打たれ強い' }, { offset: 96, name: '超ダメージ' }, { offset: 100, name: 'クリティカル(確率)' },
    { offset: 104, name: '攻撃ターゲット限定' }, { offset: 108, name: '撃破時お金アップ' }, { offset: 112, name: '城破壊が得意' },
    { offset: 116, name: '波動(確率)' }, { offset: 120, name: '波動(レベル)' }, { offset: 124, name: '攻撃力ダウン(確率)' },
    { offset: 128, name: '攻撃力ダウン(時間)' }, { offset: 132, name: '攻撃力ダウン(何%にするか)' }, { offset: 136, name: '攻撃力アップ(発動する残り体力の割合)' },
    { offset: 140, name: '攻撃力アップ(倍率) 100(χ-1)' }, { offset: 144, name: '生き残る(確率)' }, { offset: 148, name: 'メタル' },
    { offset: 152, name: '攻撃射程(遠方&前方)[4x]*' }, { offset: 156, name: '攻撃射程(遠方&後方)[4x]*' }, { offset: 160, name: '波動無効' },
    { offset: 164, name: '波動ストッパー' }, { offset: 168, name: 'ふっとばし無効' }, { offset: 172, name: '動きを止める無効' },
    { offset: 176, name: '動きを遅くする無効' }, { offset: 180, name: '攻撃力ダウン無効' }, { offset: 184, name: 'ゾンビキラー' },
    { offset: 188, name: '魔女キラー' }, { offset: 196, name: '※攻撃回数へ' }, { offset: 200, name: '※攻撃回数へ' },
    { offset: 204, name: '※攻撃回数へ' }, { offset: 208, name: '※攻撃回数へ' }, { offset: 212, name: '二撃目威力' },
    { offset: 216, name: '三撃目威力' }, { offset: 220, name: '二撃目発生f' }, { offset: 224, name: '三撃目発生f' },
    { offset: 228, name: '特性付与(一撃目)' }, { offset: 232, name: '特性付与(二撃目)' }, { offset: 236, name: '特性付与(三撃目)' },
    { offset: 240, name: '生産演出*' }, { offset: 244, name: '魂エフェクトの種類*' }, { offset: 256, name: 'バリアブレイカー(確率)' },
    { offset: 260, name: 'ワープ(確率)' }, { offset: 264, name: 'ワープ(時間)' }, { offset: 268, name: 'ワープ範囲(前方)[4x]*' },
    { offset: 272, name: 'ワープ範囲(後方)[4x]*' }, { offset: 276, name: 'ワープ無効' }, { offset: 284, name: '使徒キラー' },
    { offset: 288, name: '対古' }, { offset: 292, name: '古代の呪い無効' }, { offset: 296, name: '超打たれ強い' },
    { offset: 300, name: '極ダメージ' }, { offset: 304, 'name': '渾身の一撃(確率)' }, { offset: 308, 'name': '渾身の一撃(倍率) 100(χ-1)' },
    { offset: 312, name: '攻撃無効(確率)' }, { offset: 316, name: '攻撃無効(時間)[25x]' }, { offset: 320, name: '烈波(確率)' },
    { offset: 324, name: '烈波発生範囲(前方)[4x]*' }, { offset: 328, name: '烈波発生範囲(後方)[4x]*' }, { offset: 332, name: '烈波(レベル)' },
    { offset: 336, name: '毒撃無効' }, { offset: 340, name: '烈波無効' }, { offset: 344, name: '呪い(確率)' }, { offset: 348, name: '呪い(時間)' },
    { offset: 352, name: '小波動化(波動onの時のみ有効)' }, { offset: 356, name: 'シールドブレイカー(確率)' }, { offset: 360, name: '対悪' },
    { offset: 364, name: '超生命体特攻' }, { offset: 368, name: '魂攻撃' }, { offset: 392, name: '超獣特攻' }, { offset: 408, name: '烈波カウンター' },
    { offset: 412, name: '召喚*' }, { offset: 420, name: '超賢者特攻' }, { offset: 424, name: 'メタルキラー' },
    { offset: 428, name: '爆破(確率)' }, { offset: 432, name: '爆破発生範囲(前方)[4x]*' }, { offset: 436, name: '爆破発生範囲(後方)[4x]*' },
    { offset: 440, name: '爆破無効' },
    ].map(item => ({ ...item, checkedGreen: false, checkedRed: false, value: '' }));

    document.addEventListener('DOMContentLoaded', () => {
        const d = document;
        const getEl = (id) => d.getElementById(id);
        
        const genBtn = getEl('gen-btn');
        const resultCodeEl = getEl('result-code');
        const copyBtn = getEl('copy-btn');
        const resultArea = getEl('result-area');
        const downloadLuaSection = getEl('download-lua-section');
        const downloadLuaBtn = getEl('download-lua-btn');

        genBtn.addEventListener('click', () => {
            if (confirm("本当にコードを生成しますか？")) {
                try { genCode(); } catch (e) { alert(e.message); }
            }
        });

        const revCalcCheck = getEl('rev-calc-check');
        const revResultArea = getEl('rev-result-area');
        const revResultList = getEl('rev-result-list');
        const searchBox = getEl('search-box');
        const searchResultsWrapper = getEl('search-results-wrapper');
        const menuTabs = d.querySelector('.menu-tabs');
        const dwordIn = getEl('dword-in');
        const refineIn = getEl('refine-in');
        const reverseBtn = getEl('reverse-btn');

        const cleanNumStr = (s) => s.replace(/,/g, '').replace(/[a-zA-Z]/g, '').trim();
        const kanaToHira = (s) => s.replace(/[\u30a1-\u30f6]/g, m => String.fromCharCode(m.charCodeAt(0) - 0x60));
        
        const copyToClip = async (text) => {
            try {
                await navigator.clipboard.writeText(text);
                copyBtn.textContent = 'コピー完了！';
            } catch (err) {
                copyBtn.textContent = 'コピー失敗';
                alert('コピーに失敗しました。');
            } finally {
                setTimeout(() => { copyBtn.textContent = 'コピー'; }, 2000);
            }
        };

        const createItemHTML = (item) => `
            <div class="status-item" data-offset="${item.offset}">
                <div class="checks">
                    <input type="checkbox" class="green" data-check-type="green" data-offset="${item.offset}" ${item.checkedGreen ? 'checked' : ''}>
                    <input type="checkbox" class="red" data-check-type="red" data-offset="${item.offset}" ${item.checkedRed ? 'checked' : ''}>
                </div>
                <span class="offset">${item.offset}:</span>
                <label>${item.name}</label>
                <input type="number" data-offset="${item.offset}" value="${item.value}" placeholder="1" step="1">
            </div>`;
        
        const createBatchControlsHTML = (targetId) => `
            <div class="batch-controls" data-controls-id="${targetId}">
                <label><input type="checkbox" class="batch-check" data-check-type="green"> <span style="color:var(--secondary-color)">■</span>一括選択</label>
                <label><input type="checkbox" class="batch-check" data-check-type="red"> <span style="color:var(--red-check)">■</span>一括変更選択</label>
                <input type="number" class="batch-value" placeholder="一括入力 (赤チェック対象)">
            </div>`;

        const renderItems = (container, items) => {
            container.innerHTML = createBatchControlsHTML(container.id) + `<div class="status-grid">${items.map(createItemHTML).join('')}</div>`;
        };

        const init = () => {
            const categories = { basic: [], basic2: [], perf: [], prob: [], invalid: [], other: [] };
            const basicMainOffsets = new Set([-24, -20, -16, -12, -8, -4, 0, 4]);
            const perfKeywords = new Set(['魔女キラー', 'ゾンビキラー', 'メタルキラー', '超賢者特攻', '烈波カウンター', '超獣特攻', '魂攻撃', '攻撃ターゲット限定', '撃破時お金アップ', '超打たれ強い', '極ダメージ', '召喚', '使徒キラー', '城破壊が得意', '超ダメージ', 'めっぽう強い', '波動ストッパー']);
            const probOffsets = new Set();
            statusData.forEach(item => { if (item.name.includes('確率')) probOffsets.add(item.offset); });

            statusData.forEach(item => {
                if (item.name.includes('無効')) { categories.invalid.push(item); }
                else if (basicMainOffsets.has(item.offset)) { categories.basic.push(item); }
                else if (probOffsets.has(item.offset) || probOffsets.has(item.offset - 4) || probOffsets.has(item.offset - 8) || item.name.includes('レベル') || item.name.includes('攻撃力アップ')) { categories.prob.push(item); }
                else if (perfKeywords.has(item.name) || item.name.startsWith('対')) { categories.perf.push(item); }
                else if ((item.offset >= -24 && item.offset <= 64) || item.offset === 440) { categories.basic2.push(item); }
                else { categories.other.push(item); }
            });
            for (const catId in categories) { renderItems(getEl(`cat-${catId}`), categories[catId]); }
        };
        
        const genCode = () => {
            d.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            const refineVal = parseInt(cleanNumStr(refineIn.value), 10);
            if (isNaN(refineVal)) { refineIn.classList.add('is-invalid'); throw new Error('有効なリファイン値がありません。'); }
            const dwordVals = dwordIn.value.split(';').map(s => parseInt(cleanNumStr(s), 10)).filter(n => !isNaN(n));
            if (dwordVals.length === 0) { dwordIn.classList.add('is-invalid'); throw new Error('有効なDWORD値がありません。'); }
            const hexPattern = "h " + dwordVals.map(num => { const buf = new ArrayBuffer(4); new DataView(buf).setInt32(0, num, true); return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2, '0')).join(' '); }).join(' ');
            const edits = [];
            statusData.filter(item => item.checkedGreen).forEach(item => { const value = (item.value.trim() === '') ? 1 : parseInt(item.value, 10); if (item.value.includes('.') || isNaN(value)) { d.querySelectorAll(`[data-offset="${item.offset}"]`).forEach(el => el.classList.add('is-invalid')); throw new Error(`無効な数値です: 「${item.name}」`); } edits.push(`{offset = ${item.offset}, value = ${value}}`); });
            const rangeParts = [];
            if (getEl('range-cb').checked) rangeParts.push('gg.REGION_CODE_APP');
            if (getEl('range-other').checked) rangeParts.push('gg.REGION_OTHER');
            const rangeSetting = rangeParts.length > 0 ? rangeParts.join(' | ') : 'gg.REGION_OTHER';
            const editStr = edits.length > 0 ? '    ' + edits.join(',\n    ') : '';
            const luaScript = `gg.clearResults()\ngg.setRanges(${rangeSetting})\nlocal hexPattern = "${hexPattern}"\ngg.searchNumber(hexPattern, gg.TYPE_HEX)\nlocal hexResults = gg.getResults(99999)\nif #hexResults == 0 then gg.alert("HEXパターンが見つかりませんでした") return end\ngg.toast("見つかったアドレス数: " .. #hexResults)\nlocal dwordList = {}\nfor _, v in ipairs(hexResults) do table.insert(dwordList, { address = v.address, flags = gg.TYPE_DWORD }) end\ndwordList = gg.getValues(dwordList)\nlocal refinedList = {}\nfor _, v in ipairs(dwordList) do if v.value == ${refineVal} then table.insert(refinedList, v) end end\nif #refinedList == 0 then gg.toast("${refineVal}は見つかりませんでした") return end\nlocal editSettings = {\n${editStr}\n}\nif #editSettings > 0 then\n  for _, setting in ipairs(editSettings) do\n    local editList = {}\n    for _, v in ipairs(refinedList) do\n      table.insert(editList, { address = v.address + setting.offset, flags = gg.TYPE_DWORD, value = setting.value })\n    end\n    gg.setValues(editList)\n  end\n  gg.toast("複数オフセットの値を書き換えました")\nelse\n  gg.toast("変更項目が未選択のため、書き込みませんでした。")\nend\ngg.clearResults()`;
            resultCodeEl.textContent = luaScript.trim();
            resultArea.style.display = 'block';
            downloadLuaSection.style.display = 'block';
        };

        const syncUI = (offset) => {
            const data = statusData.find(i => i.offset == offset);
            if (!data) return;
            d.querySelectorAll(`.status-item[data-offset="${offset}"]`).forEach(itemEl => {
                const chkGreen = itemEl.querySelector('.green');
                const chkRed = itemEl.querySelector('.red');
                const val = itemEl.querySelector('input[type="number"]');
                if (chkGreen.checked !== data.checkedGreen) chkGreen.checked = data.checkedGreen;
                if (chkRed.checked !== data.checkedRed) chkRed.checked = data.checkedRed;
                if (val.value !== data.value) val.value = data.value;
            });
        };

        let rafId;
        const performSearch = () => {
            cancelAnimationFrame(rafId);
            rafId = requestAnimationFrame(() => {
                const query = searchBox.value.trim().toLowerCase();
                if (!query) { searchResultsWrapper.innerHTML = ''; searchResultsWrapper.classList.remove('active'); return; }
                const queryHira = kanaToHira(query);
                const results = statusData.filter(item => { const nameLower = item.name.toLowerCase(); const nameHira = kanaToHira(nameLower); return nameLower.includes(query) || nameHira.includes(queryHira); });
                searchResultsWrapper.innerHTML = results.length > 0 ? createBatchControlsHTML('search-results-wrapper') + `<div class="status-grid">${results.map(createItemHTML).join('')}</div>` : '<p>該当する項目はありません。</p>';
                searchResultsWrapper.classList.add('active');
            });
        };

        const downloadGeneratedLuaFile = () => {
            const codeContent = resultCodeEl.textContent;
            if (!codeContent) return alert("ダウンロードするコードがありません。");
            const now = new Date();
            const filename = `Aにゃんこ_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}${now.getMinutes().toString().padStart(2,'0')}${now.getSeconds().toString().padStart(2,'0')}.lua`;
            const blob = new Blob([codeContent], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = d.createElement('a');
            a.href = url;
            a.download = filename;
            d.body.appendChild(a);
            a.click();
            d.body.removeChild(a);
            URL.revokeObjectURL(url);
        };

        reverseBtn.addEventListener('click', () => { /* 逆算処理は省略 */ });
        copyBtn.addEventListener('click', () => copyToClip(resultCodeEl.textContent));
        downloadLuaBtn.addEventListener('click', downloadGeneratedLuaFile);
        revCalcCheck.addEventListener('change', (e) => { const isReverse = e.target.checked; genBtn.style.display = isReverse ? 'none' : 'block'; reverseBtn.style.display = isReverse ? 'block' : 'none'; resultArea.style.display = 'none'; downloadLuaSection.style.display = 'none'; });
        dwordIn.addEventListener('input', () => { const values = dwordIn.value.split(';').map(s => parseInt(cleanNumStr(s), 10)).filter(n => !isNaN(n) && n >= 5000); if (values.length > 0) { refineIn.value = Math.max(...values); } });
        menuTabs.addEventListener('click', (e) => { if (e.target.classList.contains('tab-btn')) { d.querySelector('.tab-btn.active').classList.remove('active'); d.querySelector('.category-content.active').classList.remove('active'); e.target.classList.add('active'); getEl(e.target.dataset.target).classList.add('active'); } });
        searchBox.addEventListener('input', performSearch);
        d.body.addEventListener('input', (e) => {
            const target = e.target;
            const controls = target.closest('.batch-controls');
            if (controls) {
                const container = getEl(controls.dataset.controlsId) || controls.parentElement;
                const items = Array.from(container.querySelectorAll('.status-item'));
                const checkType = target.dataset.checkType;
                if (checkType) { const isChecked = target.checked; const prop = checkType === 'green' ? 'checkedGreen' : 'checkedRed'; items.forEach(item => { const offset = item.dataset.offset; const data = statusData.find(i => i.offset == offset); if (data) data[prop] = isChecked; syncUI(offset); }); }
                if (target.matches('.batch-value')) { const value = target.value; if (value.trim() === '') return; items.forEach(item => { const offset = item.dataset.offset; const data = statusData.find(i => i.offset == offset); if (data && data.checkedRed) { data.value = value; if(!data.checkedGreen) data.checkedGreen = true; syncUI(offset); } }); }
                return;
            }
            const itemDiv = target.closest('.status-item');
            if (itemDiv) {
                const offset = itemDiv.dataset.offset;
                const data = statusData.find(i => i.offset == offset);
                if (!data) return;
                if (target.matches('input[type="checkbox"]')) { const prop = target.dataset.checkType === 'green' ? 'checkedGreen' : 'checkedRed'; data[prop] = target.checked; }
                if (target.matches('input[type="number"]')) { data.value = target.value; if (target.value.trim() !== '' && !data.checkedGreen) { data.checkedGreen = true; } }
                syncUI(offset);
            }
        });
        init();
    });
</script>

</body>
</html>